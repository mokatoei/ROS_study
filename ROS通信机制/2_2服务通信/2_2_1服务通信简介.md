## **ğŸ”¹ ä»€ä¹ˆæ˜¯ ROS æœåŠ¡é€šä¿¡ï¼ˆService Communicationï¼‰ï¼Ÿ**
ROS **æœåŠ¡é€šä¿¡ï¼ˆService Communicationï¼‰** æ˜¯ä¸€ç§ **è¯·æ±‚-å“åº”ï¼ˆRequest-Responseï¼‰** æœºåˆ¶ï¼Œé€‚ç”¨äºéœ€è¦ **å•æ¬¡è¯·æ±‚å¹¶ç­‰å¾…è¿”å›ç»“æœ** çš„é€šä¿¡åœºæ™¯ã€‚å®ƒä¸åŒäº **è¯é¢˜é€šä¿¡ï¼ˆTopic Communicationï¼‰** çš„ **æŒç»­å‘å¸ƒ/è®¢é˜…æ¨¡å¼**ã€‚

åœ¨æœåŠ¡é€šä¿¡ä¸­ï¼š
- **å®¢æˆ·ç«¯ï¼ˆClientï¼‰** å‘é€ä¸€ä¸ªè¯·æ±‚ï¼ˆRequestï¼‰ã€‚
- **æœåŠ¡å™¨ï¼ˆServerï¼‰** å¤„ç†è¯·æ±‚ï¼Œå¹¶è¿”å›å“åº”ï¼ˆResponseï¼‰ã€‚

å®ƒç±»ä¼¼äº **HTTP è¯·æ±‚**ï¼Œä¾‹å¦‚ï¼š
- **å®¢æˆ·ç«¯è¯·æ±‚**ï¼š`æˆ‘éœ€è¦å½“å‰æ—¶é—´`
- **æœåŠ¡å™¨å“åº”**ï¼š`2025-03-11 12:34:56`

æœ¬è´¨ä¸Šæ˜¯ä¸€ç§åº”ç­”æœºåˆ¶ã€‚

---

## **ğŸ”¹ è¯é¢˜é€šä¿¡ vs. æœåŠ¡é€šä¿¡**
| å¯¹æ¯”é¡¹ | è¯é¢˜é€šä¿¡ï¼ˆTopicï¼‰ | æœåŠ¡é€šä¿¡ï¼ˆServiceï¼‰ |
|--------|-----------------|---------------------|
| **æ¨¡å¼** | å‘å¸ƒ-è®¢é˜…ï¼ˆPub-Subï¼‰ | è¯·æ±‚-å“åº”ï¼ˆRequest-Responseï¼‰ |
| **æ•°æ®æµ** | **æŒç»­** å‘é€å’Œæ¥æ”¶ | **å•æ¬¡** è¯·æ±‚å’Œåº”ç­” |
| **ä½¿ç”¨åœºæ™¯** | ä¼ æ„Ÿå™¨æ•°æ®ã€æ§åˆ¶æŒ‡ä»¤ã€çŠ¶æ€æ›´æ–°ç­‰ | æœºå™¨äººæŸ¥è¯¢ä¿¡æ¯ã€æ‰§è¡Œä¸€æ¬¡æ€§ä»»åŠ¡ |
| **ç¤ºä¾‹** | å‘å¸ƒ **æ¸©åº¦æ•°æ®** | è¯·æ±‚ **å½“å‰æ¸©åº¦** |

---

## **ğŸ”¹ ROS æœåŠ¡çš„ç»„æˆ**
ROS æœåŠ¡ä½¿ç”¨ **`srv`ï¼ˆServiceï¼‰** æ–‡ä»¶æ ¼å¼å®šä¹‰è¯·æ±‚å’Œå“åº”çš„ç»“æ„ï¼Œä¸»è¦åŒ…æ‹¬ï¼š
1. **æœåŠ¡åç§°**ï¼ˆService Nameï¼‰
2. **è¯·æ±‚å‚æ•°**ï¼ˆRequestï¼‰
3. **å“åº”å‚æ•°**ï¼ˆResponseï¼‰

ä¾‹å¦‚ï¼š
```srv
int32 a
int32 b
---
int32 sum
```
è¡¨ç¤ºï¼š
- **è¯·æ±‚**ï¼šä¸¤ä¸ªæ•´æ•° `a` å’Œ `b`
- **å“åº”**ï¼šå®ƒä»¬çš„å’Œ `sum`

---

## **ğŸ”¹ å¦‚ä½•å®ç° ROS æœåŠ¡ï¼Ÿ**
### **ğŸ“Œ 1. åˆ›å»ºåŠŸèƒ½åŒ…**
```bash
cd ~/catkin_ws/src
catkin_create_pkg my_service_pkg rospy std_msgs message_generation
```

---

### **ğŸ“Œ 2. åˆ›å»º `srv` ç›®å½•**
```bash
cd ~/catkin_ws/src/my_service_pkg
mkdir srv
```
ç„¶åï¼Œåˆ›å»º `srv/AddTwoInts.srv`ï¼š
```bash
echo -e "int32 a\nint32 b\n---\nint32 sum" > srv/AddTwoInts.srv
```
è¿™é‡Œï¼š
- **`a` å’Œ `b`**ï¼šè¯·æ±‚çš„ä¸¤ä¸ªæ•´æ•°
- **`sum`**ï¼šå“åº”çš„æ±‚å’Œç»“æœ

---

### **ğŸ“Œ 3. ä¿®æ”¹ `CMakeLists.txt`**
æ‰“å¼€ `CMakeLists.txt`ï¼Œæ·»åŠ ï¼š
```cmake
find_package(catkin REQUIRED COMPONENTS rospy std_msgs message_generation)

add_service_files(
  FILES
  AddTwoInts.srv
)

generate_messages(
  DEPENDENCIES
  std_msgs
)

catkin_package(
  CATKIN_DEPENDS message_runtime
)
```

---

### **ğŸ“Œ 4. ä¿®æ”¹ `package.xml`**
æ·»åŠ ï¼š
```xml
<build_depend>message_generation</build_depend>
<exec_depend>message_runtime</exec_depend>
```

---

### **ğŸ“Œ 5. ç¼–è¯‘**
```bash
cd ~/catkin_ws
catkin_make
source devel/setup.bash
```

---

### **ğŸ“Œ 6. ç¼–å†™æœåŠ¡ç«¯ï¼ˆServerï¼‰**
åˆ›å»º `scripts/service_server.py`ï¼š
```python
#!/usr/bin/env python3
import rospy
from my_service_pkg.srv import AddTwoInts, AddTwoIntsResponse

def handle_add_two_ints(req):
    rospy.loginfo(f"Received request: a={req.a}, b={req.b}")
    return AddTwoIntsResponse(req.a + req.b)

def add_two_ints_server():
    rospy.init_node('add_two_ints_server')
    service = rospy.Service('add_two_ints', AddTwoInts, handle_add_two_ints)
    rospy.loginfo("Service 'add_two_ints' ready.")
    rospy.spin()

if __name__ == "__main__":
    add_two_ints_server()
```

**è§£é‡Šï¼š**
- `rospy.Service(name, service_class, callback)`
  - **`name`**ï¼šæœåŠ¡å `add_two_ints`
  - **`service_class`**ï¼š`AddTwoInts`ï¼ˆè‡ªå®šä¹‰çš„ `srv`ï¼‰
  - **`callback`**ï¼šå¤„ç†è¯·æ±‚çš„å‡½æ•° `handle_add_two_ints()`
- `handle_add_two_ints(req)` å¤„ç†è¯·æ±‚å¹¶è¿”å› `AddTwoIntsResponse(req.a + req.b)`

---

### **ğŸ“Œ 7. ç¼–å†™å®¢æˆ·ç«¯ï¼ˆClientï¼‰**
åˆ›å»º `scripts/service_client.py`ï¼š
```python
#!/usr/bin/env python3
import rospy
from my_service_pkg.srv import AddTwoInts, AddTwoIntsRequest

def add_two_ints_client(a, b):
    rospy.wait_for_service('add_two_ints')
    try:
        add_two_ints = rospy.ServiceProxy('add_two_ints', AddTwoInts)
        response = add_two_ints(a, b)
        return response.sum
    except rospy.ServiceException as e:
        rospy.logerr(f"Service call failed: {e}")

if __name__ == "__main__":
    rospy.init_node('add_two_ints_client')
    a, b = 5, 7
    result = add_two_ints_client(a, b)
    rospy.loginfo(f"Result: {result}")
```

**è§£é‡Šï¼š**
- `rospy.wait_for_service('add_two_ints')`ï¼šç­‰å¾…æœåŠ¡å°±ç»ª
- `rospy.ServiceProxy('add_two_ints', AddTwoInts)`ï¼š
  - è¿æ¥æœåŠ¡ `add_two_ints`
  - å‘é€ `a=5, b=7` è¯·æ±‚
  - æ¥æ”¶è¿”å›å€¼ `sum`

---

### **ğŸ“Œ 8. è¿è¡ŒæœåŠ¡é€šä¿¡**
**ï¼ˆ1ï¼‰å¯åŠ¨ ROS Master**
```bash
roscore
```
**ï¼ˆ2ï¼‰è¿è¡ŒæœåŠ¡ç«¯**
```bash
rosrun my_service_pkg service_server.py
```
**ï¼ˆ3ï¼‰è¿è¡Œå®¢æˆ·ç«¯**
```bash
rosrun my_service_pkg service_client.py
```
è¾“å‡ºï¼š
```
[INFO] Received request: a=5, b=7
[INFO] Result: 12
```

---

## **ğŸ”¹ é¢å¤–è°ƒè¯•å‘½ä»¤**
### **æŸ¥çœ‹å·²æ³¨å†Œçš„æœåŠ¡**
```bash
rosservice list
```
å¯èƒ½è¾“å‡ºï¼š
```
/add_two_ints
/rosout/get_loggers
/rosout/set_logger_level
```

### **æŸ¥çœ‹æœåŠ¡ç±»å‹**
```bash
rosservice type /add_two_ints
```
è¾“å‡ºï¼š
```
my_service_pkg/AddTwoInts
```

### **æŸ¥çœ‹æœåŠ¡æè¿°**
```bash
rossrv show my_service_pkg/AddTwoInts
```
è¾“å‡ºï¼š
```
int32 a
int32 b
---
int32 sum
```

### **æ‰‹åŠ¨è°ƒç”¨æœåŠ¡**
```bash
rosservice call /add_two_ints "a: 3
b: 8"
```
è¿”å›ï¼š
```
sum: 11
```

---

## **ğŸ”¹ æ€»ç»“**
| **æ­¥éª¤** | **æ“ä½œ** |
|-----------|-----------|
| 1ï¸âƒ£ åˆ›å»ºåŠŸèƒ½åŒ… | `catkin_create_pkg my_service_pkg rospy std_msgs message_generation` |
| 2ï¸âƒ£ å®šä¹‰ `srv` æ–‡ä»¶ | `mkdir srv && echo -e "int32 a\nint32 b\n---\nint32 sum" > srv/AddTwoInts.srv` |
| 3ï¸âƒ£ ä¿®æ”¹ `CMakeLists.txt` | æ·»åŠ  `add_service_files`ã€`generate_messages` |
| 4ï¸âƒ£ ä¿®æ”¹ `package.xml` | æ·»åŠ  `message_generation` å’Œ `message_runtime` |
| 5ï¸âƒ£ ç¼–è¯‘ | `catkin_make && source devel/setup.bash` |
| 6ï¸âƒ£ ç¼–å†™æœåŠ¡ç«¯ | `rospy.Service('add_two_ints', AddTwoInts, handle_add_two_ints)` |
| 7ï¸âƒ£ ç¼–å†™å®¢æˆ·ç«¯ | `rospy.ServiceProxy('add_two_ints', AddTwoInts)` |
| 8ï¸âƒ£ è¿è¡Œ | `rosrun my_service_pkg service_server.py` â†’ `rosrun my_service_pkg service_client.py` |

---

## **ğŸš€ æ€»ç»“**
ROS **æœåŠ¡é€šä¿¡** é€‚ç”¨äº **ä¸€æ¬¡æ€§è¯·æ±‚ + ç­‰å¾…å“åº”** çš„åœºæ™¯ï¼Œæ¯”å¦‚ï¼š
- è·å–ä¼ æ„Ÿå™¨æ•°æ®
- æœºå™¨äººè·¯å¾„è§„åˆ’
- æ§åˆ¶æœºæ¢°è‡‚æ‰§è¡Œç‰¹å®šä»»åŠ¡

ä½ å¯ä»¥è¯•ç€ä¿®æ”¹ `srv` æ–‡ä»¶ï¼Œæ·»åŠ æ–°çš„å‚æ•°ï¼Œæˆ–è€…ç¼–å†™ C++ ç‰ˆæœ¬çš„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼ğŸš€