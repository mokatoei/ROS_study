## **ğŸ”¹ å¦‚ä½•å®ç° ROS æœåŠ¡ï¼Ÿ**
### **ğŸ“Œ 1. åˆ›å»ºåŠŸèƒ½åŒ…**
```bash
cd ~/catkin_ws/src
catkin_create_pkg my_service_pkg rospy std_msgs message_generation
```

---

### **ğŸ“Œ 2. åˆ›å»º `srv` ç›®å½•**
```bash
cd ~/catkin_ws/src/my_service_pkg
mkdir srv
```
ç„¶åï¼Œåˆ›å»º `srv/AddTwoInts.srv`ï¼š
```bash
echo -e "int32 a\nint32 b\n---\nint32 sum" > srv/AddTwoInts.srv
```
è¿™é‡Œï¼š
- **`a` å’Œ `b`**ï¼šè¯·æ±‚çš„ä¸¤ä¸ªæ•´æ•°
- **`sum`**ï¼šå“åº”çš„æ±‚å’Œç»“æœ
- è‡ªå®šä¹‰æœåŠ¡ï¼ˆsrvï¼‰æ–‡ä»¶ éœ€è¦å®šä¹‰ è¯·æ±‚ï¼ˆRequestï¼‰ å’Œ å“åº”ï¼ˆResponseï¼‰ ä¸¤éƒ¨åˆ†æ•°æ®ç»“æ„ï¼Œè€Œ ---ï¼ˆä¸‰æ¨ªæ ï¼‰ æ­£æ˜¯ç”¨äºåˆ†éš”è¯·æ±‚å’Œå“åº”éƒ¨åˆ†çš„æ ‡è¯†ç¬¦ã€‚

---

### **ğŸ“Œ 3. ä¿®æ”¹ `CMakeLists.txt`**
æ‰“å¼€ `CMakeLists.txt`ï¼Œæ·»åŠ ï¼š
```cmake
find_package(catkin REQUIRED COMPONENTS rospy std_msgs message_generation)

add_service_files(
  FILES
  AddTwoInts.srv
)

generate_messages(
  DEPENDENCIES
  std_msgs
)

catkin_package(
  CATKIN_DEPENDS message_runtime
)
```

---

### **ğŸ“Œ 4. ä¿®æ”¹ `package.xml`**
æ·»åŠ ï¼š
```xml
<build_depend>message_generation</build_depend>
<exec_depend>message_runtime</exec_depend>
```

---

### **ğŸ“Œ 5. ç¼–è¯‘**
```bash
cd ~/catkin_ws
catkin_make
source devel/setup.bash
```

---

### **ğŸ“Œ 6. ç¼–å†™æœåŠ¡ç«¯ï¼ˆServerï¼‰**
åˆ›å»º `scripts/service_server.py`ï¼š
```python
#!/usr/bin/env python3
import rospy
from my_service_pkg.srv import AddTwoInts, AddTwoIntsResponse

def handle_add_two_ints(req):
    rospy.loginfo(f"Received request: a={req.a}, b={req.b}")
    return AddTwoIntsResponse(req.a + req.b)

def add_two_ints_server():
    rospy.init_node('add_two_ints_server')
    service = rospy.Service('add_two_ints', AddTwoInts, handle_add_two_ints)
    rospy.loginfo("Service 'add_two_ints' ready.")
    rospy.spin()

if __name__ == "__main__":
    add_two_ints_server()
```

**è§£é‡Šï¼š**
- `rospy.Service(name, service_class, callback)`
  - **`name`**ï¼šæœåŠ¡å `add_two_ints`
  - **`service_class`**ï¼š`AddTwoInts`ï¼ˆè‡ªå®šä¹‰çš„ `srv`ï¼‰
  - **`callback`**ï¼šå¤„ç†è¯·æ±‚çš„å‡½æ•° `handle_add_two_ints()`
- `handle_add_two_ints(req)` å¤„ç†è¯·æ±‚å¹¶è¿”å› `AddTwoIntsResponse(req.a + req.b)`

---

åˆ›å»º`src/server.cpp`:
```cpp
#include "ros/ros.h"
#include "my_pkg/AddTwoInts.h"

bool doNum(my_pkg::AddTwoInts::Request &req,
          my_pkg::AddTwoInts::Response &res)
{
  int num1 = req.a;
  int num2 = req.b;
  int sum = num1 + num2;
  res.sun = sum;
  return true;
}

int main(int argc, char *argv[])
{
  ros::init(argc, argv, "server");
  ros::NodeHandle nh;

  ros::ServiceServer ser = nh.advertiseService("AddTwoInts", doNums);

  ros::spin();
  return 0;
}
```
**è§£é‡Šï¼š**
- ros::ServiceServer æ˜¯ ROS æä¾›çš„ æœåŠ¡æœåŠ¡å™¨å¯¹è±¡ ç±»å‹ã€‚

  è¯¥å¯¹è±¡ è´Ÿè´£ç®¡ç†æœåŠ¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œå½“èŠ‚ç‚¹å…³é—­æ—¶ï¼ŒæœåŠ¡ä¹Ÿä¼šè‡ªåŠ¨æ³¨é”€ã€‚
- nh.advertiseService()
  è¿™ä¸ªå‡½æ•° åˆ›å»ºä¸€ä¸ª ROS æœåŠ¡ç«¯ï¼ˆService Serverï¼‰ï¼Œå¹¶ æ³¨å†Œ åˆ° ROS è®¡ç®—å›¾ä¸­ã€‚
  è°ƒç”¨æ ¼å¼ï¼š
  ```
  advertiseService(æœåŠ¡åç§°, å›è°ƒå‡½æ•°);
  ```


---

### **ğŸ“Œ 7. ç¼–å†™å®¢æˆ·ç«¯ï¼ˆClientï¼‰**
åˆ›å»º `scripts/service_client.py`ï¼š
```python
#!/usr/bin/env python3
import rospy
from my_service_pkg.srv import AddTwoInts, AddTwoIntsRequest

def add_two_ints_client(a, b):
    rospy.wait_for_service('add_two_ints')
    try:
        add_two_ints = rospy.ServiceProxy('add_two_ints', AddTwoInts)
        response = add_two_ints(a, b)
        return response.sum
    except rospy.ServiceException as e:
        rospy.logerr(f"Service call failed: {e}")

if __name__ == "__main__":
    rospy.init_node('add_two_ints_client')
    a, b = 5, 7
    result = add_two_ints_client(a, b)
    rospy.loginfo(f"Result: {result}")
```

**è§£é‡Šï¼š**
- `rospy.wait_for_service('add_two_ints')`ï¼šç­‰å¾…æœåŠ¡å°±ç»ª
- `rospy.ServiceProxy('add_two_ints', AddTwoInts)`ï¼š
  - è¿æ¥æœåŠ¡ `add_two_ints`
  - å‘é€ `a=5, b=7` è¯·æ±‚
  - æ¥æ”¶è¿”å›å€¼ `sum`

---
``` cpp
#include "ros/ros.h"
#include "my_pkg/AddTwoInts.h"

int main(int argc, char *argv[])
{
  if (argc != 3)
  {
    ROS_INFO("å‚æ•°ä¼ é€’æ•°é‡é”™è¯¯");
    return 1;
  }
  ros::init(argc, argv, "client");
  ros::NodeHandle nh;

  ros::ServiceClient cli = ad.serviceClient<my_pkg::AddTwoInts>("AddTwoInts");

  my_pkg::AddTwoInts ai;
  ai.request.a = atoi(argv[1]);
  ai.request.b = atoi(argv[2]);

  // ç­‰å¾…æœåŠ¡ç«¯å¼€å§‹å¹¿æ’­
  // cli.waitForService();
  ros::service::waitForService("AddTwoInts");

  bool flag = cli.call(ai);
  if (flag)
  {
    ROS_INFO("success");
    ROS_INFO("sum:%d", ai.response.sum);
  }
  else
  {
    ROS_INFO("fail");
  }
  return 0;
}
```
**è§£é‡Šï¼š**
- åœ¨ ROS å®¢æˆ·ç«¯çš„åŠ¨æ€ä¼ å‚ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ argc/argvï¼ˆC++ï¼‰æˆ– sys.argvï¼ˆPythonï¼‰æ¥ä» å‘½ä»¤è¡Œè·å–å‚æ•°ã€‚åœ¨ C++ æˆ– Python ä¸­ï¼Œå‘½ä»¤è¡Œå‚æ•°æ˜¯æŒ‰ç…§ ç©ºæ ¼åˆ†éš” ä¼ é€’çš„ï¼Œå¹¶å­˜å‚¨åœ¨ argv æ•°ç»„ä¸­ï¼š
  ``` cpp
  int main(int argc, char **argv)
  ```
  ``` python
  import sys
  sys.argv
  ```
  - argcï¼šä»£è¡¨å‚æ•°æ€»ä¸ªæ•°ï¼ˆC++ï¼‰ã€‚
  - argvï¼šå­˜å‚¨å‚æ•°çš„æ•°ç»„ï¼ˆå­—ç¬¦ä¸²æ•°ç»„ï¼‰ã€‚

---

### **ğŸ“Œ 8. è¿è¡ŒæœåŠ¡é€šä¿¡**
**ï¼ˆ1ï¼‰å¯åŠ¨ ROS Master**
```bash
roscore
```
**ï¼ˆ2ï¼‰è¿è¡ŒæœåŠ¡ç«¯**
```bash
rosrun my_service_pkg service_server.py
```
**ï¼ˆ3ï¼‰è¿è¡Œå®¢æˆ·ç«¯**
```bash
rosrun my_service_pkg service_client.py
```
è¾“å‡ºï¼š
```
[INFO] Received request: a=5, b=7
[INFO] Result: 12
```

---

## **ğŸ”¹ é¢å¤–è°ƒè¯•å‘½ä»¤**
### **æŸ¥çœ‹å·²æ³¨å†Œçš„æœåŠ¡**
```bash
rosservice list
```
å¯èƒ½è¾“å‡ºï¼š
```
/add_two_ints
/rosout/get_loggers
/rosout/set_logger_level
```

### **æŸ¥çœ‹æœåŠ¡ç±»å‹**
```bash
rosservice type /add_two_ints
```
è¾“å‡ºï¼š
```
my_service_pkg/AddTwoInts
```

### **æŸ¥çœ‹æœåŠ¡æè¿°**
```bash
rossrv show my_service_pkg/AddTwoInts
```
è¾“å‡ºï¼š
```
int32 a
int32 b
---
int32 sum
```

### **æ‰‹åŠ¨è°ƒç”¨æœåŠ¡**
```bash
rosservice call /add_two_ints "a: 3
b: 8"
```
è¿”å›ï¼š
```
sum: 11
```

---

## **ğŸ”¹ æ€»ç»“**
| **æ­¥éª¤** | **æ“ä½œ** |
|-----------|-----------|
| 1ï¸âƒ£ åˆ›å»ºåŠŸèƒ½åŒ… | `catkin_create_pkg my_service_pkg rospy std_msgs message_generation` |
| 2ï¸âƒ£ å®šä¹‰ `srv` æ–‡ä»¶ | `mkdir srv && echo -e "int32 a\nint32 b\n---\nint32 sum" > srv/AddTwoInts.srv` |
| 3ï¸âƒ£ ä¿®æ”¹ `CMakeLists.txt` | æ·»åŠ  `add_service_files`ã€`generate_messages` |
| 4ï¸âƒ£ ä¿®æ”¹ `package.xml` | æ·»åŠ  `message_generation` å’Œ `message_runtime` |
| 5ï¸âƒ£ ç¼–è¯‘ | `catkin_make && source devel/setup.bash` |
| 6ï¸âƒ£ ç¼–å†™æœåŠ¡ç«¯ | `rospy.Service('add_two_ints', AddTwoInts, handle_add_two_ints)` |
| 7ï¸âƒ£ ç¼–å†™å®¢æˆ·ç«¯ | `rospy.ServiceProxy('add_two_ints', AddTwoInts)` |
| 8ï¸âƒ£ è¿è¡Œ | `rosrun my_service_pkg service_server.py` â†’ `rosrun my_service_pkg service_client.py` |

---

## **ğŸš€ æ€»ç»“**
ROS **æœåŠ¡é€šä¿¡** é€‚ç”¨äº **ä¸€æ¬¡æ€§è¯·æ±‚ + ç­‰å¾…å“åº”** çš„åœºæ™¯ï¼Œæ¯”å¦‚ï¼š
- è·å–ä¼ æ„Ÿå™¨æ•°æ®
- æœºå™¨äººè·¯å¾„è§„åˆ’
- æ§åˆ¶æœºæ¢°è‡‚æ‰§è¡Œç‰¹å®šä»»åŠ¡